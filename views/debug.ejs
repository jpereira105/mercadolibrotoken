<!DOCTYPE html>
<html>
<head>
  <title>Debug OAuth2</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f5f5f5; }
    h2 { color: #333; }
    .ok { color: green; }
    .error { color: red; }
    pre { background: #eee; padding: 1rem; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>ğŸ” Debug OAuth2</h2>

  <ul>
  <li><strong>Entorno:</strong> <%= process.env.NODE_ENV %></li>
  <li><strong>Client ID:</strong> <%= process.env.CLIENT_ID %></li>
  <li><strong>Client Secret:</strong> <%= process.env.CLIENT_SECRET ? 'âœ… Cargado' : 'âŒ Faltante' %></li>
  <li><strong>CÃ³digo recibido:</strong> <%= code || 'âŒ No recibido' %></li>
  <li><strong>Verifier usado:</strong> <%= codeVerifier || 'âŒ No disponible' %></li>
  <li><strong>Status HTTP:</strong> <%= status %></li>
  <li><strong>Token recibido:</strong> <%= token && token.access_token ? 'âœ… OK' : 'âŒ No recibido' %></li>
  <li><strong>State recibido:</strong> <%= state || 'âŒ No recibido' %></li>
  <li><strong>State esperado:</strong> <%= expectedState || 'âŒ No disponible' %></li>
  <li><strong>State recibido:</strong> <%= state || 'âŒ No recibido' %></li>
  <li><strong>State esperado:</strong> <%= expectedState || 'âŒ No disponible' %></li>
  <li><strong>Tiempo de respuesta:</strong> <%= responseTime ? responseTime + ' ms' : 'âŒ No medido' %></li>
  <li><strong>Redirect URI usada:</strong> <%= redirectUri %></li>
    
</ul>

<% if (error) { %>
  <p style="color: red;"><strong>Error:</strong> <%= error %></p>
<% } %>

  <p><strong>CÃ³digo recibido:</strong> <%= code %></p>
  <p><strong>Code Verifier:</strong> <%= codeVerifier %></p>
  <p><strong>Status HTTP:</strong> <%= status %></p>

  <h3>ğŸ“‹ Logs:</h3>
    <ul>
        <li><%= logs.codeLog %></li>
        <li><%= logs.verifierLog %></li>
        <li><%= logs.statusLog %></li>
        <li><%= logs.stateLog %></li>
        <li><%= logs.timeLog %></li>
    </ul>  

  <% if (error) { %>
    <h3 class="error">âŒ Error:</h3>
    <pre><%= error %></pre>
  <% } else { %>
    <h3 class="ok">âœ… Token recibido:</h3>
    <pre><%= JSON.stringify(token, null, 2) %></pre>
  <% } %>
</body>
</html>
