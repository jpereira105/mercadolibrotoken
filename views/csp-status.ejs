<!DOCTYPE html>
<html>
<head>
  <title>ğŸ” Estado CSP</title>
  <link rel="stylesheet" href="/css/style.css"> <!-- âœ… AcÃ¡ va -->
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    .status { font-size: 1.5rem; margin-bottom: 1rem; }
    .ok { color: green; }
    .partial { color: orange; }
    .missing { color: red; }
    pre { background: #f4f4f4; padding: 1rem; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>ğŸ” Estado de Content-Security-Policy</h2>
  <div class="status <%= status %>">
    <% if (status === 'ok') { %>
      ğŸŸ¢ CSP activa y vÃ¡lida
    <% } else if (status === 'partial') { %>
      ğŸŸ¡ CSP presente pero incompleta
    <% } else { %>
      ğŸ”´ CSP ausente
    <% } %>
  </div>

  <h3>ğŸ“‹ Header CSP recibido:</h3>
  <pre><%= cspHeader || 'No se recibiÃ³ ningÃºn header CSP' %></pre>

  <h3>ğŸ” ValidaciÃ³n por directiva:</h3>
<table border="1" cellpadding="6" cellspacing="0" style="margin-top: 1rem;">
  <tr>
    <th>Directiva</th>
    <th>Valor</th>
    <th>Estado</th>
    <th>Sugerencia</th>
  </tr>
  <% for (let dir in estadoDirectivas) { %>
  <tr>
    <td><%= dir %></td>
    <td><%= estadoDirectivas[dir].valor || 'âŒ No definida' %></td>
    <td>
      <% const estado = estadoDirectivas[dir].estado; %>
      <% if (estado === 'ok-data') { %>
        <span style="color: green;">ğŸŸ¢ (data:)</span>
      <% } else if (estado === 'warning') { %>
        <span style="color: orange;">ğŸŸ¡ Riesgo</span>
      <% } else if (estado === 'missing') { %>
        <span style="color: red;">ğŸ”´ Faltante</span>
      <% } else { %>
        <span style="color: gray;">âšª Desconocido</span>
      <% } %>
    </td>
    <td><%= estadoDirectivas[dir].sugerencia || '-' %></td>
  </tr>
  <% } %>
</table>


<h3>ğŸ› ï¸ Sugerencias:</h3>
<ul>
  <% if (!estadoDirectivas['script-src']) { %>
    <li>âš ï¸ Falta <code>script-src</code>. PodÃ©s agregar: <code>script-src 'self'</code></li>
  <% } %>
  <% if (estadoDirectivas['style-src'] && estadoDirectivas['style-src'].valor.includes("'unsafe-inline'")) { %>
    <li>âš ï¸ EstÃ¡s usando <code>'unsafe-inline'</code> en <code>style-src</code>. ConsiderÃ¡ eliminarlo por seguridad.</li>
  <% } %>
</ul>

<!-- Panel visual de errores CSP -->
<h3>ğŸ“‰ Recursos bloqueados por CSP:</h3>
<ul id="csp-log"></ul>

<!-- Script inline que serÃ¡ bloqueado por CSP -->
<script>alert('Esto deberÃ­a ser bloqueado');</script>

<!-- Script que captura el evento de bloqueo -->
<script src="/js/csp-debug.js"></script>


</body>
</html>

